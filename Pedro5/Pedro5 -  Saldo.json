{"version":"6.1","id":"737261c7-0a82-4cb1-88e7-b29200f47064","name":"Pedro5 -  Saldo","events":[{"id":"twxdidilvt13avdfc0satitz","graphCoordinates":{"x":0,"y":0},"type":"start"}],"groups":[{"id":"yqd4ou7cdlvtyk27k9a3garl","title":"Stand by","graphCoordinates":{"x":854,"y":-19},"blocks":[{"id":"f6ub24qzdd5dmkw8biyi0fhg","type":"Set variable","options":{"variableId":"vna35ozw2scm7o9rjc95xvhot","expressionToEvaluate":"{{cardProducts}}"}},{"id":"asttojmettx0qik399wnthoq","type":"Set variable","options":{"variableId":"vfn9vyzvxi7h0ry6fynrxmryr","expressionToEvaluate":"{{selectedCard}}"}},{"id":"bqztmeakki60vt8f7imep18n","type":"Set variable","options":{"variableId":"vcqj45fjjqnqxbe332rrai968","expressionToEvaluate":"{{remoteJid}}"}},{"id":"fxkkvdarny7lcjjfh6enoanw","type":"text","content":{"richText":[{"type":"p","children":[{"text":"Iniciando processo de consulta de saldo."}]}]}},{"id":"h9mapttpf7rc5ebndfo12v70","type":"Wait","options":{"secondsToWaitFor":"2"}},{"id":"ejzlbgeknz6diznb002awpkf","type":"Set variable","options":{"variableId":"vbzsoki96y6pc658z1yhctiyt"}},{"id":"p36pk3tz86sa8g8jnj8zran8","type":"Set variable","options":{"variableId":"vfn9vyzvxi7h0ry6fynrxmryr","expressionToEvaluate":"{{selectedCard}}"}},{"id":"bkqxd938bpkbdg17dufblkdw","type":"Code","options":{"content":"var cardProducts = (JSON.parse({{cardProducts}})).filter(d=>JSON.parse(d).cardNumber === {{selectedCard}}).map(d=>JSON.parse(d)).map(d=>({type: \"reply\", displayText:d.description, id: d.id.toString() }));\n\nvar remoteJid = {{remoteJid}};\nvar body = `\n{\n    \"number\": \"`+remoteJid+`\",\n    \"title\": \"Qual modalidade deseja consultar?\",\n    \"description\": \"Description Button\",\n    \"footer\": \"Footer Button\",\n    \"buttons\": `+JSON.stringify(cardProducts)+`\n       \n}`;\n\nsetVariable('body', JSON.parse(body));\n\n\n\n","isExecutedOnClient":false}},{"id":"zpx1dbq94aarxghwh9cmyc4l","type":"Webhook","options":{"isCustomBody":true,"webhook":{"headers":[{"id":"o7d1502ecsolomdvfxa6d51p","key":"apiKey","value":"pRVp9gp/2)z1e\"-*u8*9.jSgLQ2PK6W72G"}],"url":"https://evo.prd.votorantim.tmob.com.br/message/sendButtons/Livramento","body":"{{body}}"}}},{"id":"xx306x51h68fxxhhbh6w2t01","type":"text input","options":{"variableId":"vj2vvtqkfn9abjgopkien7n19"}},{"id":"g7vejd49jef7dsnpvdtr4i73","type":"Webhook","options":{"responseVariableMapping":[{"id":"ljv1vjjsvomg7qapy84k15ny","variableId":"vy3i7pyf7lath4sezqpeowh74","bodyPath":"data"}],"webhook":{"method":"GET","url":"https://Pedro-api.prd.votorantim3.tmob.com.br/api/Balance/getBalanceOfCardNumber?cardNumber={{selectedCard}}"}}},{"id":"zdepf4u5u7vgrdmupfdy5o31","type":"Set variable","options":{"variableId":"vgcl7ekihd2ae8f6zxk9jwtev","expressionToEvaluate":"const balanceProduct = {{balanceProduct}};\nvar  products = (JSON.parse({{cardProducts}})).map(d=>JSON.parse(d));\nvar selectedProduct = products.find(d=>d.description.includes({{produto}}));\n\n\nvar balance = balanceProduct.find(d=>JSON.parse(d).applicationId == selectedProduct.code);\nreturn balance.total;","isCode":true}},{"id":"tm8bis574xbgxebm2hqxw1w2","type":"text","content":{"richText":[{"type":"p","children":[{"text":"{{balance}}"}]}]}}]}],"edges":[],"variables":[{"id":"vgcl7ekihd2ae8f6zxk9jwtev","name":"balance","isSessionVariable":true},{"id":"vna35ozw2scm7o9rjc95xvhot","name":"cardProducts","isSessionVariable":true},{"id":"vcqj45fjjqnqxbe332rrai968","name":"remoteJid","isSessionVariable":true},{"id":"vy3i7pyf7lath4sezqpeowh74","name":"balanceProduct","isSessionVariable":true},{"id":"vfn9vyzvxi7h0ry6fynrxmryr","name":"selectedCard","isSessionVariable":true},{"id":"vj2vvtqkfn9abjgopkien7n19","name":"produto","isSessionVariable":false},{"id":"vbzsoki96y6pc658z1yhctiyt","name":"body","isSessionVariable":true}],"theme":{},"selectedThemeTemplateId":null,"settings":{},"createdAt":"2025-10-23T09:48:44.379Z","updatedAt":"2025-10-23T09:48:44.379Z","icon":null,"folderId":"0e1b7072-90ec-4311-b9e9-97caed6d9f87","publicId":"Pedro5-saldo-gu11l6a","customDomain":null,"workspaceId":"cm7dahbq50001c7m972ujn7jt","resultsTablePreferences":null,"isArchived":false,"isClosed":false,"whatsAppCredentialsId":"c2dd75b8-aeed-47f2-87ae-26a072eedca6","riskLevel":null}